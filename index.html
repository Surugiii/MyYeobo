<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <title>Our Moments Â· memory lane</title>
  <!-- Bootstrap 5 + Icons + Google Fonts (romantic & clean) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <!-- custom soft touch -->
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(145deg, #fff9f9 0%, #ffeef0 100%);
      color: #4a2e2e;
      margin: 0;
      padding: 0;
    }
    h1, h2, h3, h4, .navbar-brand, .display-6 {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .navbar {
      background: rgba(255, 245, 245, 0.92) !important;
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 20px rgba(220, 80, 100, 0.05);
    }
    .navbar-brand i {
      color: #c4455c;
      margin-right: 6px;
    }
    .hero-section {
      background: radial-gradient(circle at 10% 30%, #ffe9e9, #ffdbdb);
      padding: 4rem 2rem;
      border-radius: 0 0 40px 40px;
      box-shadow: 0 6px 18px rgba(200, 100, 120, 0.1);
    }
    .hero-title {
      font-size: 3.2rem;
      color: #6d3b3b;
      text-shadow: 2px 2px 8px rgba(255, 220, 220, 0.6);
    }
    .memory-card {
      border: none;
      border-radius: 28px;
      background-color: #ffffff;
      transition: all 0.25s ease-in-out;
      box-shadow: 0 8px 18px rgba(170, 100, 110, 0.08);
      overflow: hidden;
    }
    .memory-card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 20px 30px rgba(190, 80, 100, 0.15);
    }
    .card-img-top {
      height: 200px;
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.2s;
    }
    .memory-icon {
      font-size: 5rem;
      color: #fff;
      text-shadow: 0 4px 12px rgba(0,0,0,0.1);
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(2px);
      padding: 12px;
      border-radius: 50%;
    }
    .btn-memory {
      background: #ffd3d3;
      border: 1px solid #ffb3b3;
      color: #6d3b3b;
      border-radius: 40px;
      padding: 8px 18px;
      font-weight: 500;
      transition: 0.2s;
    }
    .btn-memory:hover {
      background: #ffbebe;
      border-color: #c4455c;
      color: #4a1e1e;
    }
    .badge-soft {
      background-color: #ffebeb;
      color: #b14b4b;
      font-weight: 400;
      padding: 6px 14px;
      border-radius: 30px;
      font-size: 0.8rem;
    }
    footer {
      background: #ffe3e3;
      color: #794949;
      border-top: 2px solid #ffcece;
    }
    footer i {
      color: #c4455c;
    }
    .modal-content {
      border-radius: 30px;
      border: none;
      background: #fffbfb;
    }
    .modal-header {
      border-bottom: 2px dashed #fbc4c4;
    }
    .heart-separator {
      width: 60px;
      height: 2px;
      background: #ffa5a5;
      margin: 20px auto;
      opacity: 0.6;
    }
    .memory-count-badge {
      background: white;
      padding: 8px 24px;
      border-radius: 60px;
      box-shadow: 0 4px 12px #ffd6d6;
      display: inline-block;
      color: #b3475c;
    }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">

  <!-- ===== SOFT NAVBAR ===== -->
  <nav class="navbar navbar-expand-lg navbar-light py-3">
    <div class="container">
      <a class="navbar-brand fw-bold fs-3" href="#">
        <i class="bi bi-heart-fill"></i> Moments with you
      </a>
      <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="#gallery"><i class="bi bi-images me-1"></i>Memories</a></li>
          <li class="nav-item"><a class="nav-link" href="#footer"><i class="bi bi-envelope-heart me-1"></i>for you</a></li>
        </ul>
      </div>
      <div class="d-flex align-items-center ms-3">
        <button id="addMemoryBtn" class="btn btn-outline-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#addMemoryModal">
          <i class="bi bi-upload me-1"></i> Add
        </button>
      </div>
    </div>
  </nav>

  <!-- ===== HERO â€“ OUR STORY ===== -->
  <section class="hero-section text-center text-dark bg-opacity-10 mx-3 mx-md-5 mt-3 mb-4">
    <div class="container">
      <i class="bi bi-suit-heart-fill" style="font-size: 3.2rem; color: #c4455c; opacity: 0.8;"></i>
      <h1 class="hero-title display-3 fw-bold">our journey, framed</h1>
      <p class="fs-5 col-lg-8 mx-auto" style="color: #5e3a3a;">every laugh, every glance â€” a collection of us.<br> i built this little world for our memories. ðŸ’Œ</p>
      <div class="mt-4">
        <a href="#gallery" class="btn btn-lg rounded-pill px-5 py-3 shadow-sm" style="background: #c4455c; color: white; border: none;">âœ¨ explore moments</a>
      </div>
    </div>
  </section>

  <!-- ===== MEMORY GALLERY ===== -->
  <div id="gallery" class="container my-5 pt-3">
    <div class="d-flex flex-wrap align-items-center justify-content-between mb-5">
      <h2 class="display-6 fw-bold" style="color: #653b3b;"><i class="bi bi-camera me-3" style="color: #c4455c;"></i> memory archive</h2>
      <span class="memory-count-badge fw-semibold"><i class="bi bi-heart me-1"></i> <span id="memory-count">0</span> treasured moments</span>
    </div>

    <!-- Template for memory cards (used to create new entries) -->
    <template id="memory-template">
      <div class="col-6 col-md-4 col-lg-3 moment-card-col">
        <div class="card memory-card h-100">
          <div class="card-img-top d-flex align-items-center justify-content-center" style="background-color: var(--bgcolor, #ffd9d9); position:relative;">
            <img class="card-photo d-none" src="" alt="memory photo" style="width:100%;height:100%;object-fit:cover;position:absolute;left:0;top:0;" />
            <i class="memory-icon bi bi-camera-fill" style="color: var(--iconcolor, #ff7a7a); font-size:4rem; z-index:1;"></i>
          </div>
          <div class="card-body d-flex flex-column">
            <span class="badge-soft align-self-start mb-2"><i class="bi bi-calendar-heart me-1"></i> <span class="memory-date">DATE</span></span>
            <h5 class="card-title fw-bold fs-5 memory-title">TITLE</h5>
            <p class="card-text small memory-desc">DESCRIPTION</p>
            <button class="btn btn-memory mt-3 w-100 relive-btn"
                    data-bs-toggle="modal"
                    data-bs-target="#memoryModal"
                    data-memory-title="TITLE"
                    data-memory-story="STORY">
              <i class="bi bi-arrow-right-circle me-1"></i> relive moment
            </button>

            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-sm btn-outline-secondary flex-grow-1 edit-btn"><i class="bi bi-pencil"></i> Edit</button>
              <button class="btn btn-sm btn-outline-danger delete-btn"><i class="bi bi-trash"></i> Delete</button>
            </div>
          </div>
        </div>
      </div>
    </template>

    <!-- Bootstrap grid with moments (cards) â€“ each moment card is a precious tile -->
    <div class="row g-4" id="moment-grid">
      <!-- card 1 : beach day -->
      <div class="col-6 col-md-4 col-lg-3 moment-card-col">
        <div class="card memory-card h-100" data-memory-id="1">
          <div class="card-img-top" style="background-color: #ffd9d9;">
            <i class="bi bi-umbrella-fill memory-icon" style="color: #ff7a7a;"></i>
          </div>
          <div class="card-body d-flex flex-column">
            <span class="badge-soft align-self-start mb-2"><i class="bi bi-calendar-heart me-1"></i>September 25, 2024</span>
            <h5 class="card-title fw-bold fs-5">The Start</h5>
            <p class="card-text small" style="color: #5f4b4b;">Holding, silent, until I let my heart talk</p>
            <button class="btn btn-memory mt-3 w-100" 
                    data-bs-toggle="modal" 
                    data-bs-target="#memoryModal"
                    data-memory-title="sunset beach"
                    data-memory-story="We drove for two hours, just to catch the sunset. You brought strawberries and a blanket. The sky turned lavender and peach. We talked about childhood dreams and didnâ€™t want to leave. I took your photo when you werenâ€™t looking â€” your smile still glows.">
              <i class="bi bi-arrow-right-circle me-1"></i> relive moment
            </button>
          </div>
        </div>
      </div>
      <!-- card 2 : birthday surprise -->
      <div class="col-6 col-md-4 col-lg-3 moment-card-col">
        <div class="card memory-card h-100">
          <div class="card-img-top" style="background-color: #d9e6ff;">
            <i class="bi bi-gift-fill memory-icon" style="color: #5f9ea0;"></i>
          </div>
          <div class="card-body d-flex flex-column">
            <span class="badge-soft align-self-start mb-2"><i class="bi bi-calendar-heart me-1"></i> sept 22, 2023</span>
            <h5 class="card-title fw-bold fs-5">birthday morning</h5>
            <p class="card-text small">surprise breakfast in bed + hand-lettered card.</p>
            <button class="btn btn-memory mt-3 w-100"
                    data-bs-toggle="modal"
                    data-bs-target="#memoryModal"
                    data-memory-title="birthday morning"
                    data-memory-story="You thought I forgot. But I woke up at 5am to bake your favorite cinnamon rolls. I put a tiny candle on top and tiptoed to your room. Your sleepy smile was the best gift. We ate them on the balcony, still in pajamas.">
              <i class="bi bi-arrow-right-circle me-1"></i> relive moment
            </button>
          </div>
        </div>
      </div>
      <!-- card 3 : mountain hike -->
      <div class="col-6 col-md-4 col-lg-3 moment-card-col">
        <div class="card memory-card h-100">
          <div class="card-img-top" style="background-color: #e0f0d9;">
            <i class="bi bi-tree-fill memory-icon" style="color: #56855a;"></i>
          </div>
          <div class="card-body d-flex flex-column">
            <span class="badge-soft align-self-start mb-2"><i class="bi bi-calendar-heart me-1"></i> oct 5, 2023</span>
            <h5 class="card-title fw-bold fs-5">misty hike</h5>
            <p class="card-text small">we got lost, but found the best viewpoint.</p>
            <button class="btn btn-memory mt-3 w-100"
                    data-bs-toggle="modal"
                    data-bs-target="#memoryModal"
                    data-memory-title="misty hike"
                    data-memory-story="The trail was muddier than expected. You held my hand the whole way. At the clearing, fog covered the valley â€” but we sat on a wet log, shared a granola bar, and named the clouds. It felt like our own secret world.">
              <i class="bi bi-arrow-right-circle me-1"></i> relive moment
            </button>
          </div>
        </div>
      </div>
      <!-- card 4 : coffee date -->
      <div class="col-6 col-md-4 col-lg-3 moment-card-col">
        <div class="card memory-card h-100">
          <div class="card-img-top" style="background-color: #f9e1c2;">
            <i class="bi bi-cup-fill memory-icon" style="color: #b08968;"></i>
          </div>
          <div class="card-body d-flex flex-column">
            <span class="badge-soft align-self-start mb-2"><i class="bi bi-calendar-heart me-1"></i> nov 12, 2023</span>
            <h5 class="card-title fw-bold fs-5">rainy coffee</h5>
            <p class="card-text small">hid from rain in that tiny bookstore-cafÃ©.</p>
            <button class="btn btn-memory mt-3 w-100"
                    data-bs-toggle="modal"
                    data-bs-target="#memoryModal"
                    data-memory-title="rainy coffee"
                    data-memory-story="We ducked inside when the downpour started. You ordered a cappuccino, I got chai. We found a novel on the shelf and read passages to each other. Three hours disappeared. Outside, the world was blurred; inside, only us.">
              <i class="bi bi-arrow-right-circle me-1"></i> relive moment
            </button>
          </div>
        </div>
      </div>
      <!-- card 5 : concert night -->
      <div class="col-6 col-md-4 col-lg-3 moment-card-col">
        <div class="card memory-card h-100">
          <div class="card-img-top" style="background-color: #ecd9ff;">
            <i class="bi bi-music-note-beamed memory-icon" style="color: #9b6db7;"></i>
          </div>
          <div class="card-body d-flex flex-column">
            <span class="badge-soft align-self-start mb-2"><i class="bi bi-calendar-heart me-1"></i> dec 3, 2023</span>
            <h5 class="card-title fw-bold fs-5">under the strings</h5>
            <p class="card-text small">indie band, we danced in the back row.</p>
            <button class="btn btn-memory mt-3 w-100"
                    data-bs-toggle="modal"
                    data-bs-target="#memoryModal"
                    data-memory-title="under the strings"
                    data-memory-story="The guitarist had a flower in her hair. You pulled me close during the slow song â€” we werenâ€™t great dancers but we didnâ€™t care. The bass vibrated through my chest. I remember the fairy lights and your hand in mine.">
              <i class="bi bi-arrow-right-circle me-1"></i> relive moment
            </button>
          </div>
        </div>
      </div>
      <!-- card 6 : new year's eve -->
      <div class="col-6 col-md-4 col-lg-3 moment-card-col">
        <div class="card memory-card h-100">
          <div class="card-img-top" style="background-color: #ffe5b4;">
            <i class="bi bi-stars memory-icon" style="color: #d4af37;"></i>
          </div>
          <div class="card-body d-flex flex-column">
            <span class="badge-soft align-self-start mb-2"><i class="bi bi-calendar-heart me-1"></i> dec 31, 2023</span>
            <h5 class="card-title fw-bold fs-5">midnight kiss</h5>
            <p class="card-text small">rooftop fireworks, glitter on your coat.</p>
            <button class="btn btn-memory mt-3 w-100"
                    data-bs-toggle="modal"
                    data-bs-target="#memoryModal"
                    data-memory-title="midnight kiss"
                    data-memory-story="We climbed to the roof with paper cups of sparkling cider. The city exploded in color. You had silver glitter on your cheek. At midnight, we kissed â€” and it wasnâ€™t just new year, it was the start of everything.">
              <i class="bi bi-arrow-right-circle me-1"></i> relive moment
            </button>
          </div>
        </div>
      </div>
      <!-- card 7 : weekend getaway -->
      <div class="col-6 col-md-4 col-lg-3 moment-card-col">
        <div class="card memory-card h-100">
          <div class="card-img-top" style="background-color: #ffe0f0;">
            <i class="bi bi-house-heart-fill memory-icon" style="color: #d66b7c;"></i>
          </div>
          <div class="card-body d-flex flex-column">
            <span class="badge-soft align-self-start mb-2"><i class="bi bi-calendar-heart me-1"></i> feb 14, 2024</span>
            <h5 class="card-title fw-bold fs-5">cabin stay</h5>
            <p class="card-text small">fireplace, board games, no phones.</p>
            <button class="btn btn-memory mt-3 w-100"
                    data-bs-toggle="modal"
                    data-bs-target="#memoryModal"
                    data-memory-title="cabin stay"
                    data-memory-story="We rented the tiniest cabin. You made hot chocolate and we played scrabble by the fire. I let you win. At night, we sat on the porch wrapped in one blanket, counting stars. No service, no distractions â€” just us.">
              <i class="bi bi-arrow-right-circle me-1"></i> relive moment
            </button>
          </div>
        </div>
      </div>
      <!-- card 8 : anniversary -->
      <div class="col-6 col-md-4 col-lg-3 moment-card-col">
        <div class="card memory-card h-100">
          <div class="card-img-top" style="background-color: #ffd0dd;">
            <i class="bi bi-heart-fill memory-icon" style="color: #c4455c;"></i>
          </div>
          <div class="card-body d-flex flex-column">
            <span class="badge-soft align-self-start mb-2"><i class="bi bi-calendar-heart me-1"></i> apr 18, 2024</span>
            <h5 class="card-title fw-bold fs-5">one year</h5>
            <p class="card-text small">picnic at the spot we first met.</p>
            <button class="btn btn-memory mt-3 w-100"
                    data-bs-toggle="modal"
                    data-bs-target="#memoryModal"
                    data-memory-title="one year"
                    data-memory-story="We went back to the park bench. Same bench, but everything else had changed. You made a playlist of 'our year' and we listened with headphones sharing earbuds. You gave me a tiny box â€” not a ring, but a compass. 'so we always find each other.'">
              <i class="bi bi-arrow-right-circle me-1"></i> relive moment
            </button>
          </div>
        </div>
      </div>
    </div> <!-- row end -->
    
    <div class="heart-separator"></div>
    <p class="text-center text-muted mt-4 fst-italic" style="font-size: 1.1rem;">ðŸ’­ each card holds a story â€” click "relive moment" to open the memory.</p>
  </div>

  <!-- ===== MODAL â€“ ADD MEMORY ===== -->
  <div class="modal fade" id="addMemoryModal" tabindex="-1" aria-labelledby="addMemoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header" style="background: #fff0f0; border-bottom: 2px dashed #fbc4c4;">
          <h5 class="modal-title fw-bold" id="addMemoryModalLabel">Add a memory</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form id="addMemoryForm">
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Title</label>
              <input type="text" class="form-control" id="memoryTitleInput" placeholder="e.g. sunset beach" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Date</label>
              <input type="date" class="form-control" id="memoryDateInput">
            </div>
            <div class="mb-3">
              <label class="form-label">Short description</label>
              <input type="text" class="form-control" id="memoryDescInput" placeholder="one-line description">
            </div>
            <div class="mb-3">
              <label class="form-label">Story</label>
              <textarea class="form-control" id="memoryStoryInput" rows="4" placeholder="Write the memory..." required></textarea>
            </div>
            <div class="row g-2">
              <div class="col-12">
                <label class="form-label">Image (optional)</label>
                <input type="file" id="memoryImageInput" class="form-control" accept="image/*">
                <input type="hidden" id="memoryImageData">
                <div class="mt-2">
                  <img id="memoryImagePreview" src="" class="img-fluid d-none" style="max-height:140px; object-fit:cover; border-radius:12px;" alt="preview">
                </div>
              </div>
              <div class="col-4">
                <label class="form-label">Color</label>
                <input type="color" id="memoryColorInput" class="form-control form-control-color" value="#ffd9d9">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-danger">Add memory</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ===== MODAL â€“ MEMORY DETAIL ===== (Bootstrap 5) -->
  <div class="modal fade" id="memoryModal" tabindex="-1" aria-labelledby="memoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0" style="background: #ffeaea;">
          <h4 class="modal-title fw-bold" id="memoryModalLabel" style="color: #6d3b3b;">
            <i class="bi bi-heart-fill me-2" style="color: #c4455c;"></i> memory
          </h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-4">
          <div class="text-center mb-3">
            <i class="bi bi-camera fs-1" style="color: #c07a7a;"></i>
          </div>
          <h3 class="text-center fw-bold" id="memoryModalTitle">beach sunset</h3>
          <p class="mt-4 px-2" id="memoryModalStory" style="line-height: 1.8; color: #4f3737;">memory story will appear here...</p>
        </div>
        <div class="modal-footer border-0 justify-content-center">
          <button type="button" class="btn btn-memory px-5" data-bs-dismiss="modal">
            <i class="bi bi-heart"></i> close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== FOOTER â€“ for my love ===== -->
  <footer id="footer" class="mt-auto text-center py-5">
    <div class="container">
      <i class="bi bi-suit-heart-fill" style="font-size: 2rem; color: #c4455c;"></i>
      <p class="mt-3 fs-5 fw-light" style="letter-spacing: 1.5px;">made for you</p>
      <p class="mt-3 mb-0">I love you</p>
      <div class="mt-3 text-muted small">
        <i class="bi bi-dot"></i> replace the icons, photos & stories â€” this is our canvas <i class="bi bi-dot"></i>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function() {
      "use strict";

      const memoryCards = document.querySelectorAll('.moment-card-col');
      const memoryCountSpan = document.getElementById('memory-count');
      if (memoryCountSpan) {
        memoryCountSpan.textContent = memoryCards.length;
      }

      // ---------- 2. dynamic modal content using Bootstrap 5 event ----------
      const memoryModal = document.getElementById('memoryModal');
      if (memoryModal) {
        memoryModal.addEventListener('show.bs.modal', function(event) {
          // Button that triggered the modal
          const button = event.relatedTarget;
          
          // Extract info from data-* attributes
          const title = button.getAttribute('data-memory-title');
          const story = button.getAttribute('data-memory-story');
          
          // Update the modal's content
          const modalTitle = memoryModal.querySelector('#memoryModalTitle');
          const modalStory = memoryModal.querySelector('#memoryModalStory');
          
          if (modalTitle) modalTitle.textContent = title || 'our memory';
          if (modalStory) modalStory.textContent = story || 'a sweet moment we shared.';
        });
      }

      // ---------- 3. optional: smooth scroll for "explore moments" ----------
      const exploreBtn = document.querySelector('a[href="#gallery"]');
      if (exploreBtn) {
        exploreBtn.addEventListener('click', function(e) {
          e.preventDefault();
          document.querySelector('#gallery')?.scrollIntoView({ behavior: 'smooth' });
        });
      }
      
      // ---------- 4. add-memory form handling, templating, edit & delete ----------
      const addMemoryForm = document.getElementById('addMemoryForm');
      const memoryTemplate = document.getElementById('memory-template');
      const momentGrid = document.getElementById('moment-grid');
      const memoryImageInput = document.getElementById('memoryImageInput');
      const memoryImagePreview = document.getElementById('memoryImagePreview');
      const memoryImageData = document.getElementById('memoryImageData');

      function updateMemoryCount() {
        const count = document.querySelectorAll('.moment-card-col').length;
        if (memoryCountSpan) memoryCountSpan.textContent = count;
      }

      // helper to generate a simple unique id
      function makeId() {
        return 'm' + Date.now().toString(36) + Math.floor(Math.random()*1000).toString(36);
      }

      // show image preview and store data url in hidden input
      if (memoryImageInput) {
        memoryImageInput.addEventListener('change', function() {
          const file = memoryImageInput.files && memoryImageInput.files[0];
          if (!file) {
            memoryImagePreview.src = '';
            memoryImagePreview.classList.add('d-none');
            memoryImageData.value = '';
            return;
          }
          const reader = new FileReader();
          reader.onload = function(ev) {
            memoryImagePreview.src = ev.target.result;
            memoryImagePreview.classList.remove('d-none');
            memoryImageData.value = ev.target.result;
          };
          reader.readAsDataURL(file);
        });
      }

      let editingCard = null;

      function attachControlsToCard(colEl) {
        const card = colEl.querySelector('.card');
        if (!card) return;

        // ensure card has an id
        if (!card.dataset.memoryId) card.dataset.memoryId = makeId();

        // add edit/delete if missing
        const body = colEl.querySelector('.card-body');
        if (!body) return;

        if (!body.querySelector('.edit-btn')) {
          const controls = document.createElement('div');
          controls.className = 'd-flex gap-2 mt-3';
          controls.innerHTML = '<button class="btn btn-sm btn-outline-secondary flex-grow-1 edit-btn"><i class="bi bi-pencil"></i> Edit</button><button class="btn btn-sm btn-outline-danger delete-btn"><i class="bi bi-trash"></i> Delete</button>';
          body.appendChild(controls);
        }

        const editBtn = colEl.querySelector('.edit-btn');
        const deleteBtn = colEl.querySelector('.delete-btn');

        editBtn?.addEventListener('click', function() { openEditModalFor(colEl); });
        deleteBtn?.addEventListener('click', function() { deleteCard(colEl); });
      }

      function openEditModalFor(colEl) {
        const card = colEl.querySelector('.card');
        editingCard = colEl;

        // populate fields from card
        const title = colEl.querySelector('.card-title')?.textContent || '';
        const desc = colEl.querySelector('.card-text')?.textContent || '';
        const dateText = colEl.querySelector('.badge-soft .memory-date')?.textContent || colEl.querySelector('.badge-soft')?.textContent || '';
        const reliveBtn = colEl.querySelector('.relive-btn');
        const story = reliveBtn?.getAttribute('data-memory-story') || '';
        const color = colEl.querySelector('.card-img-top')?.style.backgroundColor || '';
        const photo = colEl.querySelector('.card-photo');

        document.getElementById('memoryTitleInput').value = title;
        // try to parse date as ISO if possible, otherwise leave blank
        try { document.getElementById('memoryDateInput').value = new Date(dateText).toISOString().slice(0,10); } catch(e) { document.getElementById('memoryDateInput').value = ''; }
        document.getElementById('memoryDescInput').value = desc;
        document.getElementById('memoryStoryInput').value = story;
        document.getElementById('memoryColorInput').value = rgbToHex(color) || '#ffd9d9';

        if (photo && photo.src) {
          memoryImagePreview.src = photo.src;
          memoryImagePreview.classList.remove('d-none');
          memoryImageData.value = photo.src;
        } else {
          memoryImagePreview.src = '';
          memoryImagePreview.classList.add('d-none');
          memoryImageData.value = '';
        }

        // ensure the modal shows
        const modal = new bootstrap.Modal(document.getElementById('addMemoryModal'));
        modal.show();
        // update submit button text
        addMemoryForm.querySelector('button[type="submit"]').textContent = 'Save changes';
      }

      function deleteCard(colEl) {
        colEl.remove();
        updateMemoryCount();
      }

      function rgbToHex(rgb) {
        if (!rgb) return null;
        const m = rgb.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
        if (!m) return null;
        return '#' + [1,2,3].map(i => parseInt(m[i]).toString(16).padStart(2,'0')).join('');
      }

      function createCard({title, date, desc, story, color, imageData}) {
        const clone = memoryTemplate.content.cloneNode(true);
        const col = clone.querySelector('.moment-card-col');
        const card = col.querySelector('.card');
        const cardImg = col.querySelector('.card-img-top');
        const iconEl = col.querySelector('.memory-icon');
        const photoEl = col.querySelector('.card-photo');
        const titleEl = col.querySelector('.memory-title');
        const descEl = col.querySelector('.memory-desc');
        const dateEl = col.querySelector('.memory-date');
        const reliveBtn = col.querySelector('.relive-btn');

        if (!card.dataset.memoryId) card.dataset.memoryId = makeId();
        if (cardImg) cardImg.style.backgroundColor = color || '#ffd9d9';

        if (imageData) {
          photoEl.src = imageData;
          photoEl.classList.remove('d-none');
          iconEl.classList.add('d-none');
        } else {
          photoEl.src = '';
          photoEl.classList.add('d-none');
          iconEl.classList.remove('d-none');
        }

        if (titleEl) titleEl.textContent = title || 'untitled';
        if (descEl) descEl.textContent = desc || '';
        if (dateEl) dateEl.textContent = date ? new Date(date).toLocaleDateString() : '';
        if (reliveBtn) {
          reliveBtn.setAttribute('data-memory-title', title || '');
          reliveBtn.setAttribute('data-memory-story', story || '');
        }

        momentGrid.appendChild(col);
        attachControlsToCard(col);
        updateMemoryCount();
      }

      // attach edit/delete to all existing cards
      document.querySelectorAll('#moment-grid .moment-card-col').forEach(function(col) {
        attachControlsToCard(col);
      });

      if (addMemoryForm && memoryTemplate && momentGrid) {
        addMemoryForm.addEventListener('submit', function(e) {
          e.preventDefault();

          const title = document.getElementById('memoryTitleInput').value.trim() || 'untitled';
          const date = document.getElementById('memoryDateInput').value || '';
          const desc = document.getElementById('memoryDescInput').value.trim() || '';
          const story = document.getElementById('memoryStoryInput').value.trim() || '';
          const color = document.getElementById('memoryColorInput').value || '#ffd9d9';
          const imageData = memoryImageData.value || '';

          if (editingCard) {
            // update existing
            const col = editingCard;
            const cardImg = col.querySelector('.card-img-top');
            const iconEl = col.querySelector('.memory-icon');
            const photoEl = col.querySelector('.card-photo');
            const titleEl = col.querySelector('.card-title');
            const descEl = col.querySelector('.card-text');
            const dateEl = col.querySelector('.badge-soft');
            const reliveBtn = col.querySelector('.relive-btn');

            if (cardImg) cardImg.style.backgroundColor = color;
            if (imageData) {
              photoEl.src = imageData;
              photoEl.classList.remove('d-none');
              iconEl.classList.add('d-none');
            } else {
              photoEl.src = '';
              photoEl.classList.add('d-none');
              iconEl.classList.remove('d-none');
            }
            if (titleEl) titleEl.textContent = title;
            if (descEl) descEl.textContent = desc;
            if (dateEl) dateEl.textContent = date ? new Date(date).toLocaleDateString() : '';
            if (reliveBtn) {
              reliveBtn.setAttribute('data-memory-title', title);
              reliveBtn.setAttribute('data-memory-story', story);
            }

            // reset state
            editingCard = null;
            addMemoryForm.querySelector('button[type="submit"]').textContent = 'Add memory';
          } else {
            // create new card
            createCard({ title, date, desc, story, color, imageData });
          }

          // reset form and close modal
          addMemoryForm.reset();
          memoryImagePreview.src = '';
          memoryImagePreview.classList.add('d-none');
          memoryImageData.value = '';
          const addModal = bootstrap.Modal.getInstance(document.getElementById('addMemoryModal'));
          if (addModal) addModal.hide();
        });
      }
      
    })();
  </script>

  <!-- tiny extra for bootstrap icons and manual nav smooth -->
  <style>
    html {
      scroll-behavior: smooth;
    }
    .navbar-nav .nav-link {
      font-weight: 400;
      color: #6d3b3b !important;
      border-radius: 40px;
      padding: 8px 20px;
      transition: 0.2s;
    }
    .navbar-nav .nav-link:hover {
      background: #ffdbdb;
    }
  </style>
</body>
</html>
